using UnityEngine;
using Random = UnityEngine.Random;

public class MalwareRotateDefiner : MonoBehaviour
{
    float moveSpeed = 2f;
    Animator animator;
    bool drumSituation;
    GameManager gameManager;
    int drumCount;
    
    void OnEnable()
    {
        FindAnimatorComponent();
        FindGameManager();
        FindDrumSituation();
        DefineMalwareRotate();
    }
    
    void FixedUpdate() => MoveMalwareToPlayer();

    void FindDrumSituation() => drumSituation = gameManager.isDrumActive;

    void FindAnimatorComponent() => animator =  this.gameObject.GetComponent<Animator>();
    
    void FindGameManager() => gameManager =  FindObjectOfType<GameManager>();

    void MoveMalwareToPlayer() =>
        this.transform.position = new Vector3( this.transform.position.x,  this.transform.position.y,
            this.transform.position.z - moveSpeed * Time.deltaTime);
    
    bool IsEvenNumber(int number)
    {
        return number % 2 == 0;
    }

    void DefineMalwareRotate()
    {
        drumCount = gameManager.drumCountNumber;
        
        if (!drumSituation)
        {
            var number = Random.Range(0, 4);
            var rotateNumber = number + 1;
            SetAnimatorNumber(rotateNumber);
        
            Vector3 malwarePos = new Vector3( this.transform.rotation.x,  this.transform.rotation.y,  this.transform.rotation.z + 90 * rotateNumber);
            transform.Rotate(malwarePos);
        }
        else
        {
            if (IsEvenNumber(drumCount))
            {
                SetAnimatorNumber(2);
            }
            else
            {
                SetAnimatorNumber(4);
            }
        }
        //TODO: do not change game manager from here.
        if (gameManager.drumCountPermission <= 2)
        {
            gameManager.drumCountPermission++;
        }
        else
        {
            gameManager.drumCountPermission = 0;
            drumCount++;
            gameManager.drumCountNumber = drumCount;
        }
    }

    void SetAnimatorNumber(int animNumber)
    {
        switch (animNumber)
        {
            case 1:
                this.animator.SetBool("isLeft", true);
                break;
            case 2:
                this.animator.SetBool("isBot", true);
                break;
            case 3:
                this.animator.SetBool("isRight", true);
                break;
            case 4:
                this.animator.SetBool("isTop", true);
                break;
        }
    }
}
